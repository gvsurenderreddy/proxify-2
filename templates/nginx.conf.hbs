# Internet HTTP (redirect)
server {
  listen      8000;
  server_name data.$DOMAIN;
  rewrite     ^ https://$server_name$request_uri? permanent;
}

# Internet HTTPS
# Private server to issue/revoke certificates
server {
  listen      4430 ssl;
  server_name ca.$DOMAIN;

  # Enable Stapling
  ssl_stapling            on;
  ssl_stapling_verify     on;

  # Client certificate authentication
  set $authorized_common_name $DOMAIN;
  set $unauthorized_redirect http://ca.$DOMAIN;
  include /config/verify_client.conf;

  location / {
    proxy_pass http://$HOST_IP:11443;
    include /config/proxy_params.conf;
  }
}
